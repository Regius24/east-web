<template>
  <q-dialog
    ref="dialog"
    @hide="onDialogHide"
  >
    <q-card class="q-dialog-plugin overflow-hidden">
      <q-card-section>
        <q-file
          outlined
          counter
          accept=".xlsx"
          :label="`Upload data for ${brand} Leavers Daily (.xlsx)`"
          v-model="file"
          :disable="loading"
          :loading="loading"
          @input="processFile"
        >
          <template v-slot:prepend>
            <q-icon name="attach_file" />
          </template>
        </q-file>
      </q-card-section>
    </q-card>
  </q-dialog>
</template>

<script>
import { notify } from 'boot/notifier'
import PostRepo from 'src/repository/post'

export default {
  props: ['brand'],

  data () {
    return {
      file: null,
      loading: false
    }
  },

  methods: {
    async processFile (file) {
      this.loading = true

      try {
        const formData = new FormData()
        formData.append('file', file)

        const result = await PostRepo[`UploadLeaverMonthly${this.brand}File`](formData)
        console.log(result)

        this.loading = true
        notify('Success', 'data has been uploaded', 'mdi-check', 'green')

        // setTimeout(() => {
        //   this.$router.go()
        // }, 1200)
      } catch (err) {
        this.loading = true

        console.log(err)
        notify('Error encountered', 'data was not uploaded', 'mdi-alert', 'red')
      }
    },

    show () {
      this.$refs.dialog.show()
    },
    hide () {
      this.$refs.dialog.hide()
    },
    onDialogHide () {
      this.$emit('hide')
    },
    onOKClick () {
      this.$emit('ok')
      this.hide()
    },
    onCancelClick () {
      this.hide()
    }
  }
}
</script>
